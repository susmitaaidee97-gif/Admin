<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BETX Admin Panel</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background-color: #0d1b2a;
      color: white;
      text-align: center;
    }
    .login-box, .dashboard {
      max-width: 400px;
      margin: 80px auto;
      padding: 20px;
      border-radius: 10px;
      background-color: #1b263b;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }
    h2 {
      margin-bottom: 20px;
    }
    input {
      width: 90%;
      padding: 10px;
      margin: 10px 0;
      border: none;
      border-radius: 5px;
    }
    button {
      width: 95%;
      padding: 12px;
      margin-top: 15px;
      border: none;
      border-radius: 5px;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    .green-btn { background-color: #2ecc71; }
    .orange-btn { background-color: #e67e22; }
    .blue-box {
      background-color: #0077b6;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
    }
    .logout-btn {
      background-color: #e63946;
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <!-- LOGIN PAGE -->
  <div id="login" class="login-box">
    <h2>Admin Login</h2>
    <input type="text" id="username" placeholder="Username"><br>
    <input type="password" id="password" placeholder="Password"><br>
    <button onclick="login()">Login</button>
    <p id="loginError" style="color: red;"></p>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" class="dashboard" style="display:none;">
    <h2>My Account</h2>
    <p>EPOS N¬∫ <b>-Don ‚ù§Ô∏è</b></p>
    <p>Location: NEPAL üá≥üáµ</p>

    <div class="blue-box">
      <h1 id="balance">0</h1>
      <p>NPR (Re)</p>
    </div>

    <h3>Deposit to Player</h3>
    <input type="text" id="playerId" placeholder="Enter Player Account No."><br>
    <input type="number" id="amount" placeholder="Enter Amount"><br>
    <button class="green-btn" onclick="deposit()">Deposit</button>

    <button class="orange-btn" disabled>Withdraw (Coming Soon)</button>

    <button class="logout-btn" onclick="logout()">LOG OUT</button>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCv3gDLEUhuHdMDPc2RX2AzLvihDfm-Exgo",
      authDomain: "betx-74dff.firebaseapp.com",
      projectId: "betx-74dff",
      storageBucket: "betx-74dff.appspot.com",
      messagingSenderId: "85279852822",
      appId: "1:85279852822:web:91ef8-dad8794d820416837",
      measurementId: "G-NX5D0BF329"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // LOGIN
    function login() {
      const user = document.getElementById("username").value;
      const pass = document.getElementById("password").value;
      if(user === "Don" && pass === "000") {
        document.getElementById("login").style.display = "none";
        document.getElementById("dashboard").style.display = "block";
        loadBalance();
      } else {
        document.getElementById("loginError").innerText = "Invalid Username or Password!";
      }
    }

    // LOAD ADMIN BALANCE
    async function loadBalance() {
      const ref = doc(db, "admin", "Don");
      const snap = await getDoc(ref);
      if(snap.exists()) {
        document.getElementById("balance").innerText = snap.data().balance;
      } else {
        await setDoc(ref, { balance: 0 });
        document.getElementById("balance").innerText = 0;
      }
    }

    // DEPOSIT FUNCTION
    async function deposit() {
      const playerId = document.getElementById("playerId").value;
      const amount = parseInt(document.getElementById("amount").value);
      if(!playerId || !amount) { alert("Enter all details!"); return; }

      const adminRef = doc(db, "admin", "Don");
      const playerRef = doc(db, "players", playerId);

      // Deduct from Admin, Add to Player
      const adminSnap = await getDoc(adminRef);
      if(adminSnap.exists()) {
        let adminBal = adminSnap.data().balance;
        if(adminBal < amount) {
          alert("Not enough balance!");
          return;
        }
        await updateDoc(adminRef, { balance: adminBal - amount });
        document.getElementById("balance").innerText = adminBal - amount;
      }

      const playerSnap = await getDoc(playerRef);
      if(playerSnap.exists()) {
        let playerBal = playerSnap.data().balance;
        await updateDoc(playerRef, { balance: playerBal + amount });
      } else {
        await setDoc(playerRef, { balance: amount });
      }

      alert("Deposited NPR " + amount + " to player " + playerId);
    }

    // LOGOUT
    function logout() {
      document.getElementById("dashboard").style.display = "none";
      document.getElementById("login").style.display = "block";
    }

    window.login = login;
    window.deposit = deposit;
    window.logout = logout;
  </script>
</body>
</html>
